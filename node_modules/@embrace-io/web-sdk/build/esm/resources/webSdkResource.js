import { resourceFromAttributes } from '@opentelemetry/resources';
import { ATTR_USER_AGENT_ORIGINAL, ATTR_TELEMETRY_SDK_LANGUAGE, ATTR_TELEMETRY_SDK_VERSION, ATTR_TELEMETRY_SDK_NAME, ATTR_SERVICE_NAME } from '@opentelemetry/semantic-conventions';
import { SDK_VERSION, NATIVE_FRAMEWORK, TEMPLATE_APP_VERSION, EMBRACE_SERVICE_NAME } from './constants/index.js';
import { getAppInstanceId } from './appInstanceId.js';
import { KEY_EMB_APP_INSTANCE_ID } from '../constants/attributes.js';

const getWebSDKResource = ({ diagLogger, appVersion, pageSessionStorage })=>{
    /* We need to trim the app  version to remove any leading/trailing spaces
    added by our cli tool. This is required to guarantee that the version is always
    20 characters long in the final bundle, so sourcemaps don't get confused by
    changing the length of the inlined app version. E.g. versions "0.0.1" and "0.0.115"
    are both valid, but injecting them without leading whitespaces will result in
    different lengths, pushing the sourcemaps mapping out of range. Instead,
    "               0.0.1" and "             0.0.115" are both 20 characters long,
    and we trim them before loading at runtime

    if the app version has been passed as an argument, we use it instead of the
    one processed by our cli tool. This will allow for no cli installations,
    like importing the web sdk from a CDN
    */ const processedAppVersion = appVersion ?? TEMPLATE_APP_VERSION.trim();
    return resourceFromAttributes({
        [ATTR_SERVICE_NAME]: EMBRACE_SERVICE_NAME,
        [ATTR_TELEMETRY_SDK_NAME]: EMBRACE_SERVICE_NAME,
        app_version: processedAppVersion,
        app_framework: NATIVE_FRAMEWORK,
        sdk_version: SDK_VERSION,
        [ATTR_TELEMETRY_SDK_VERSION]: SDK_VERSION,
        sdk_simple_version: 1,
        sdk_platform: 'web',
        [ATTR_TELEMETRY_SDK_LANGUAGE]: 'webjs',
        [KEY_EMB_APP_INSTANCE_ID]: getAppInstanceId(pageSessionStorage, diagLogger),
        [ATTR_USER_AGENT_ORIGINAL]: window.navigator.userAgent,
        screen_resolution: `${window.screen.width}x${window.screen.height}`
    });
};

export { getWebSDKResource };
//# sourceMappingURL=webSdkResource.js.map
