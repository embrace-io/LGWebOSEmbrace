{"version":3,"file":"SpanScrubProcessor.js","sources":["../../../../src/processors/SpanScrubProcessor/SpanScrubProcessor.ts"],"sourcesContent":["import type { ReadableSpan, SpanProcessor } from '@opentelemetry/sdk-trace-web';\nimport type { SpanScrubProcessorArgs } from './types.js';\nimport type { AttributeScrubber } from '../../common/index.js';\n\nexport class SpanScrubProcessor implements SpanProcessor {\n  private readonly _attributeScrubbers: AttributeScrubber[];\n\n  public constructor({ attributeScrubbers }: SpanScrubProcessorArgs) {\n    this._attributeScrubbers = attributeScrubbers;\n  }\n\n  public forceFlush(): Promise<void> {\n    return Promise.resolve(undefined);\n  }\n\n  // TODO `onEnd` is not supposed to modify the span. There is a new experimental onEnding api that allows modifying\n  public onEnd(span: ReadableSpan): void {\n    this._attributeScrubbers.forEach(scrubber => {\n      const value = span.attributes[scrubber.key];\n      if (value && typeof value === 'string') {\n        span.attributes[scrubber.key] = scrubber.scrub(value);\n      }\n    });\n  }\n\n  public onStart(this: void): void {\n    // do nothing.\n  }\n\n  public shutdown(): Promise<void> {\n    return Promise.resolve(undefined);\n  }\n}\n"],"names":["SpanScrubProcessor","attributeScrubbers","_attributeScrubbers","forceFlush","Promise","resolve","undefined","onEnd","span","forEach","scrubber","value","attributes","key","scrub","onStart","shutdown"],"mappings":"AAIO,MAAMA,kBAAAA,CAAAA;IAGX,WAAA,CAAmB,EAAEC,kBAAkB,EAA0B,CAAE;QACjE,IAAI,CAACC,mBAAmB,GAAGD,kBAAAA;AAC7B,IAAA;IAEOE,UAAAA,GAA4B;QACjC,OAAOC,OAAAA,CAAQC,OAAO,CAACC,SAAAA,CAAAA;AACzB,IAAA;;AAGOC,IAAAA,KAAAA,CAAMC,IAAkB,EAAQ;AACrC,QAAA,IAAI,CAACN,mBAAmB,CAACO,OAAO,CAACC,CAAAA,QAAAA,GAAAA;AAC/B,YAAA,MAAMC,QAAQH,IAAAA,CAAKI,UAAU,CAACF,QAAAA,CAASG,GAAG,CAAC;YAC3C,IAAIF,KAAAA,IAAS,OAAOA,KAAAA,KAAU,QAAA,EAAU;gBACtCH,IAAAA,CAAKI,UAAU,CAACF,QAAAA,CAASG,GAAG,CAAC,GAAGH,QAAAA,CAASI,KAAK,CAACH,KAAAA,CAAAA;AACjD,YAAA;AACF,QAAA,CAAA,CAAA;AACF,IAAA;IAEOI,OAAAA,GAA0B;;AAEjC,IAAA;IAEOC,QAAAA,GAA0B;QAC/B,OAAOZ,OAAAA,CAAQC,OAAO,CAACC,SAAAA,CAAAA;AACzB,IAAA;AACF;;;;"}