{"version":3,"file":"GlobalExceptionInstrumentation.cjs","sources":["../../../../../src/instrumentations/exceptions/GlobalExceptionInstrumentation/GlobalExceptionInstrumentation.ts"],"sourcesContent":["import type { GlobalExceptionInstrumentationArgs } from './types.js';\nimport { EmbraceInstrumentationBase } from '../../EmbraceInstrumentationBase/index.js';\n\nexport class GlobalExceptionInstrumentation extends EmbraceInstrumentationBase {\n  private readonly _onErrorHandler: (event: ErrorEvent) => void;\n  private readonly _onUnhandledRejectionHandler: (\n    event: PromiseRejectionEvent\n  ) => void;\n\n  public constructor({ diag, perf }: GlobalExceptionInstrumentationArgs = {}) {\n    super({\n      instrumentationName: 'GlobalExceptionInstrumentation',\n      instrumentationVersion: '1.0.0',\n      diag,\n      perf,\n      config: {},\n    });\n    this._onErrorHandler = (event: ErrorEvent) => {\n      this.logManager.logException(event.error || event.message, {\n        handled: false,\n        timestamp: this.perf.epochMillisFromOriginOffset(event.timeStamp),\n      });\n    };\n    this._onUnhandledRejectionHandler = (event: PromiseRejectionEvent) => {\n      let error: Error;\n      if (event.reason && event.reason instanceof Error) {\n        error = event.reason;\n      } else {\n        error = new Error(\n          typeof event.reason === 'string'\n            ? event.reason\n            : 'Unhandled Rejected Promise'\n        );\n        error.stack = '';\n      }\n\n      this.logManager.logException(error, {\n        handled: false,\n        timestamp: this.perf.epochMillisFromOriginOffset(event.timeStamp),\n      });\n    };\n\n    if (this._config.enabled) {\n      this.enable();\n    }\n  }\n\n  public disable(): void {\n    window.removeEventListener('error', this._onErrorHandler);\n    window.removeEventListener(\n      'unhandledrejection',\n      this._onUnhandledRejectionHandler\n    );\n  }\n\n  public enable(): void {\n    window.addEventListener('error', this._onErrorHandler);\n    window.addEventListener(\n      'unhandledrejection',\n      this._onUnhandledRejectionHandler\n    );\n  }\n}\n"],"names":["GlobalExceptionInstrumentation","EmbraceInstrumentationBase","diag","perf","instrumentationName","instrumentationVersion","config","_onErrorHandler","event","logManager","logException","error","message","handled","timestamp","epochMillisFromOriginOffset","timeStamp","_onUnhandledRejectionHandler","reason","Error","stack","_config","enabled","enable","disable","window","removeEventListener","addEventListener"],"mappings":";;;;AAGO,MAAMA,8BAAAA,SAAuCC,qDAAAA,CAAAA;IAMlD,WAAA,CAAmB,EAAEC,IAAI,EAAEC,IAAI,EAAsC,GAAG,EAAE,CAAE;AAC1E,QAAA,KAAK,CAAC;YACJC,mBAAAA,EAAqB,gCAAA;YACrBC,sBAAAA,EAAwB,OAAA;AACxBH,YAAAA,IAAAA;AACAC,YAAAA,IAAAA;AACAG,YAAAA,MAAAA,EAAQ;AACV,SAAA,CAAA;QACA,IAAI,CAACC,eAAe,GAAG,CAACC,KAAAA,GAAAA;YACtB,IAAI,CAACC,UAAU,CAACC,YAAY,CAACF,MAAMG,KAAK,IAAIH,KAAAA,CAAMI,OAAO,EAAE;gBACzDC,OAAAA,EAAS,KAAA;AACTC,gBAAAA,SAAAA,EAAW,IAAI,CAACX,IAAI,CAACY,2BAA2B,CAACP,MAAMQ,SAAS;AAClE,aAAA,CAAA;AACF,QAAA,CAAA;QACA,IAAI,CAACC,4BAA4B,GAAG,CAACT,KAAAA,GAAAA;YACnC,IAAIG,KAAAA;AACJ,YAAA,IAAIH,MAAMU,MAAM,IAAIV,KAAAA,CAAMU,MAAM,YAAYC,KAAAA,EAAO;AACjDR,gBAAAA,KAAAA,GAAQH,MAAMU,MAAM;YACtB,CAAA,MAAO;gBACLP,KAAAA,GAAQ,IAAIQ,MACV,OAAOX,KAAAA,CAAMU,MAAM,KAAK,QAAA,GACpBV,KAAAA,CAAMU,MAAM,GACZ,4BAAA,CAAA;AAENP,gBAAAA,KAAAA,CAAMS,KAAK,GAAG,EAAA;AAChB,YAAA;AAEA,YAAA,IAAI,CAACX,UAAU,CAACC,YAAY,CAACC,KAAAA,EAAO;gBAClCE,OAAAA,EAAS,KAAA;AACTC,gBAAAA,SAAAA,EAAW,IAAI,CAACX,IAAI,CAACY,2BAA2B,CAACP,MAAMQ,SAAS;AAClE,aAAA,CAAA;AACF,QAAA,CAAA;AAEA,QAAA,IAAI,IAAI,CAACK,OAAO,CAACC,OAAO,EAAE;AACxB,YAAA,IAAI,CAACC,MAAM,EAAA;AACb,QAAA;AACF,IAAA;IAEOC,OAAAA,GAAgB;AACrBC,QAAAA,MAAAA,CAAOC,mBAAmB,CAAC,OAAA,EAAS,IAAI,CAACnB,eAAe,CAAA;AACxDkB,QAAAA,MAAAA,CAAOC,mBAAmB,CACxB,oBAAA,EACA,IAAI,CAACT,4BAA4B,CAAA;AAErC,IAAA;IAEOM,MAAAA,GAAe;AACpBE,QAAAA,MAAAA,CAAOE,gBAAgB,CAAC,OAAA,EAAS,IAAI,CAACpB,eAAe,CAAA;AACrDkB,QAAAA,MAAAA,CAAOE,gBAAgB,CACrB,oBAAA,EACA,IAAI,CAACV,4BAA4B,CAAA;AAErC,IAAA;AACF;;;;"}