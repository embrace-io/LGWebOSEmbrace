{"version":3,"file":"EmbraceErrorBoundary.cjs","sources":["../../../../../../src/instrumentations/exceptions/react/EmbraceErrorBoundary/EmbraceErrorBoundary.ts"],"sourcesContent":["import * as React from 'react';\nimport type { PropsWithChildren } from 'react';\nimport type { LogManager } from '../../../../api-logs/index.js';\nimport { log } from '../../../../api-logs/index.js';\nimport {\n  EMB_ERROR_INSTRUMENTATIONS,\n  KEY_EMB_INSTRUMENTATION,\n} from '../../../../constants/index.js';\n\ntype EmbraceErrorBoundaryProps = {\n  fallback: () => React.ReactNode;\n};\n\ntype EmbraceErrorBoundaryState = {\n  hasError: boolean;\n};\n\nexport class EmbraceErrorBoundary<\n  P extends PropsWithChildren<EmbraceErrorBoundaryProps>,\n> extends React.Component<P, EmbraceErrorBoundaryState> {\n  private readonly _logManager: LogManager;\n\n  public constructor(props: P) {\n    super(props);\n\n    this._logManager = log.getLogManager();\n    this.state = {\n      hasError: false,\n    };\n  }\n\n  public static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  public override componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    this._logManager.logException(error, {\n      handled: false,\n      attributes: {\n        'react.component_stack': errorInfo.componentStack ?? undefined,\n        [KEY_EMB_INSTRUMENTATION]:\n          EMB_ERROR_INSTRUMENTATIONS.ReactErrorBoundary,\n      },\n    });\n  }\n\n  public override render() {\n    if (this.state.hasError) {\n      return this.props.fallback();\n    }\n\n    return this.props.children;\n  }\n}\n"],"names":["EmbraceErrorBoundary","React","Component","props","_logManager","log","getLogManager","state","hasError","getDerivedStateFromError","componentDidCatch","error","errorInfo","logException","handled","attributes","componentStack","undefined","KEY_EMB_INSTRUMENTATION","EMB_ERROR_INSTRUMENTATIONS","ReactErrorBoundary","render","fallback","children"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAiBO,MAAMA,oBAAAA,SAEHC,gBAAAA,CAAMC,SAAS,CAAA;AAGvB,IAAA,WAAA,CAAmBC,KAAQ,CAAE;AAC3B,QAAA,KAAK,CAACA,KAAAA,CAAAA;AAEN,QAAA,IAAI,CAACC,WAAW,GAAGC,UAAAA,CAAIC,aAAa,EAAA;QACpC,IAAI,CAACC,KAAK,GAAG;YACXC,QAAAA,EAAU;AACZ,SAAA;AACF,IAAA;AAEA,IAAA,OAAcC,wBAAAA,GAA2B;QACvC,OAAO;YAAED,QAAAA,EAAU;AAAK,SAAA;AAC1B,IAAA;IAEgBE,iBAAAA,CAAkBC,KAAY,EAAEC,SAA0B,EAAE;AAC1E,QAAA,IAAI,CAACR,WAAW,CAACS,YAAY,CAACF,KAAAA,EAAO;YACnCG,OAAAA,EAAS,KAAA;YACTC,UAAAA,EAAY;gBACV,uBAAA,EAAyBH,SAAAA,CAAUI,cAAc,IAAIC,SAAAA;gBACrD,CAACC,kCAAAA,GACCC,qCAAAA,CAA2BC;AAC/B;AACF,SAAA,CAAA;AACF,IAAA;IAEgBC,MAAAA,GAAS;AACvB,QAAA,IAAI,IAAI,CAACd,KAAK,CAACC,QAAQ,EAAE;AACvB,YAAA,OAAO,IAAI,CAACL,KAAK,CAACmB,QAAQ,EAAA;AAC5B,QAAA;AAEA,QAAA,OAAO,IAAI,CAACnB,KAAK,CAACoB,QAAQ;AAC5B,IAAA;AACF;;;;"}